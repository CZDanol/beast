% !TeX spellcheck = en_US

\include{header}
\include{mainpage}
\include{support}

\setlength\extrarowheight{2pt}

% Title Page
\title{NATI (Not All That Innovative) programming language}
\subtitle{Language specification/reference}
\author{Daniel ÄŒejchan}
\date{2016}


\begin{document}
\mainpage
%\renewcommand{\clearpage}{}

\chapter{Table of contents}
\makeatletter
\@starttoc{toc}
\makeatother

\chapter{Lexical}
In the normal code, NATI accepts only standard ASCII characters. Non-ascii characters are allowed only in comments and string literals.

\begin{grammar}
	\tokenDef{Whitespace} \verb|[\n\t ]+|
\end{grammar}

\section{Identifiers}
\begin{grammar}
	\tokenDef{Identifier} \verb|#?[a-zA-Z_][a-zA-Z_0-9]*|
\end{grammar}
An identifier consists of any combination of lower and upper case ASCII letters, numbers and undescores, with these additional rules:
\begin{itemize}
	\item An identifier cannot begin with a number.
	\item An identifier can begin with the hasthag (\verb|#|) character. These identifiers are used in various language constructs and can have restrictions of where and how they can be used in declarations.
\end{itemize}

\section{Keywords} \label{keywords}
Most of the keywords are not actually used in the language, but they might be in the future.
\begin{code}
alias, auto, blueprint, break, case, class, continue, debug, decorator, delegate, do, else, enum, except, false, finally, for, foreach, function, generic, goto, if, import, in, is, loop, module, return, scope, singleton, switch, template, this, throw, true, try, type, while, with, yield
\end{code}

\section{Literals}
\begin{grammar}
	\grDef{Literal} \gr{LiteralBase} [ \token{Identifier} ] \\
	\grDef{LiteralBase} \gr{StringLiteral} \\
		\grAltLn \gr{IntLiteral} \\
		\grAltLn \gr{BinLiteral} \\
		\grAltLn \gr{OctLiteral} \\
		\grAltLn \gr{HexLiteral} \\
		\grAltLn \gr{FloatLiteral} \\
\end{grammar}

\paragraph{See also} \nameref{literalUnits}

\subsection{Integer literal}
\begin{grammar}
	\tokenDef{IntLiteral} \verb|-?[0-9]+| \\
	\tokenDef{BinLiteral} \verb|0b[01]+| \\
	\tokenDef{OctLiteral} \verb|0o[0-7]+| \\
	\tokenDef{HexLiteral} \verb|0x[0-9a-fA-F]+|
\end{grammar}

\paragraph{Data type} Type of a literal is always the smallest signed type possible. If the number doesn't fit in the signed variant but fits in the unsigned variant with the same size, the unsigned variant is used. If the required bit count exceeds 128, a \type{BigInt} type is used.

For non-decimal systems, smallest unsigned variant is used.

\begin{code}
10 // Int8
128 // UInt8
-10 // Int8
-150 // Int16
60000 // Int16
0xaa // UInt8
0xa01 // UInt16
\end{code}

\subsection{Float literal}
\begin{grammar}
	\tokenDef{FloatLiteral} \verb|[0-9]*\.[0-9]+|
\end{grammar}

\paragraph{Data type} Float literal is always of type \type{Float64}. It is recommended to use the \verb|f| \hyperref[literalUnits]{literal unit} for casting to \type{Float32}.

\paragraph{TODO} string literals, boolean literals, literal units

\section{Comments}
\begin{grammar}
	\tokenDef{LineComment} \verb|//[^\n$][\n$]| \\
	\tokenDef{Comment} \verb|/\*.*?\*/|
\end{grammar}
Additionally, \textbf{comments can be nested}.

\begin{code}
void main() {
	/* This is a comment
		/* This is a comment, too. */
		Still a comment */
	thisIsACode();
}
\end{code}

\chapter{Syntactic}
\begin{grammar}
	\grDef{ExtendedIdentifier} \token{Identifier} \{ \kwd{.} \token{Identifier} \}
\end{grammar}

\chapter{Expressions}
\begin{grammar}
	\grDef{Expression} \gr{AssignExpr} \\
	\grDef{CommaExpression} \gr{Expression} \{ \kwd{,} \gr{Expression} \} \\
	
	\\
	
	\grDef{ParentCommaExpr} \kwd{(} [ \gr{ParentCommaExprItem} \{ \kwd{,} \gr{ParentCommaExprItem} \} ] \kwd{)} \\
	\grDef{ParentCommaExprItem} \gr{InexprVarDecl} | [ \kwd{::} ] \gr{Expression} \\
	
\end{grammar}

\section{Operators}
\begin{grammar}
	\grDef{RangeExpr} \gr{TernExpr} \\
		\grAltLn \gr{TernExpr} \kwd{..} \gr{TernExpr} \\
	
	\grDef{AssignExpr} \gr{TernExpr} \\
		\grAltLn \gr{TernExpr} \gr{AssignOpOp} \gr{TernExpr} \\
		\grAltLn \gr{TernExpr} \{ \kwd{=} \gr{TernExpr} \}+ \\
		\grAltLn \gr{TernExpr} \{ \kwd{:=} \gr{TernExpr} \}+ \\
	
	\grDef{TernExpr} \gr{LogicExpr} \\
		\grAltLn \gr{LogicExpr} \kwd{?} \gr{LogicExpr} \kwd{:} \gr{LogicExpr} \\
	
	\grDef{LogicExpr} \gr{CmpExpr} \\
		\grAltLn \gr{CmpExpr} \{ \kwd{\&\&} \gr{CmpExpr} \}+ \\
		\grAltLn \gr{CmpExpr} \{ \kwd{||} \gr{CmpExpr} \}+ \\
		
	\grDef{CmpExpr} \gr{BitExpr} \\
		\grAltLn \gr{BitExpr} ( \kwd{is} | \kwd{!is} | \kwd{in} | \kwd{!in} | \kwd{!=} ) \gr{BitExpr} \\
		\grAltLn \gr{BitExpr} \{ ( \kwd{==} | \kwd{>=} | \kwd{>} ) \gr{BitExpr} \}+ \\
		\grAltLn \gr{BitExpr} \{ ( \kwd{==} | \kwd{<=} | \kwd{<} ) \gr{BitExpr} \}+ \\
		
	\grDef{BitExpr} \gr{SumExpr} \\
		\grAltLn \gr{UnaryExpr} ( \kwd{>{}>} | \kwd{<{}<} | \kwd{>{}>{}>} | \kwd{<{}<{}<} ) \gr{UnaryExpr} \\
		\grAltLn \gr{UnaryExpr} \{ \kwd{\&} \gr{UnaryExpr} \}+ \\
		\grAltLn \gr{UnaryExpr} \{ \kwd{|} \gr{UnaryExpr} \}+ \\
		\grAltLn \gr{UnaryExpr} \{ \kwd{\^} \gr{UnaryExpr} \}+ \\
	
	\grDef{SumExpr} \gr{MultExpr} \\
		\grAltLn \gr{MultExpr} \{ ( \kwd{+} | \kwd{-} ) \gr{MultExpr} \}+ \\
	
	\grDef{MultExpr} \gr{UnaryExpr} \\
		\grAltLn \gr{UnaryExpr} \{ ( \kwd{*} | \kwd{/} ) \gr{UnaryExpr} \}+ \\
		\grAltLn \gr{UnaryExpr} \kwd{\%} \gr{UnaryExpr} \\
	
	\grDef{UnaryExpr} \gr{P1Expr} \\
		\grAltLn ( \kwd{!} | \kwd{-} | \kwd{\~} | \kwd{*} | \kwd{\&} | \kwd{++} | \kwd{-{}-} ) \gr{P1Expr} \\
		\grAltLn \gr{P1Expr} ( \kwd{++} | \kwd{-{}-} ) \\
		\grAltLn \gr{P1Expr} \{ \kwd{\&} | \kwd{*} | \kwd{!} \}+ \\
		\grAltLn \gr{InlineVarDecl} \\
		\grAltLn \kwd{\$} \\
	
	\grDef{P1Expr} \gr{AtomExpr} \\
		\grAltLn \gr{AtomExpr} \{ \gr{P1Op} \} \\
	
	\grDef{AtomExpr} \token{Identifier} \\
		\grAltLn \kwd{(} \gr{Expression} \kwd{)} \\
	
	\\
	
	\grDef{AssignOpOp} \kwd{+=} | \kwd{-=} | \kwd{*=} | \kwd{/=} | \kwd{\%=} | \kwd{\&=} | \kwd{|=} | \kwd{\^{}=} | \kwd{<{}<=} \\
		\grAltLn \kwd{>{}>=} | \kwd{<{}<{}<=} | \kwd{>{}>{}>=} \\
	
	\grDef{P1Op} \gr{ParentCommaExpr} \\
		\grAltLn \kwd{[} [ \gr{RangeExpr} \{ \kwd{,} \gr{RangeExpr} ] \kwd{]} \\
		\grAltLn \kwd{.} \token{Identifier} \\
\end{grammar}

\subsection{Operator precedence}
\begin{centeredRefTabular}{P{1.5cm} | c | c | p{6cm} | c}
	\textbf{Priority} & \textbf{Operator} & \textbf{Enum} & \textbf{Semantics} & \textbf{Associativity} \\ \hline
	
	1
		& \verb|x(args)| & \verb|funcCall| & Function call & Left to right \\
		& \verb|x[args]| & \verb|brackets| & Array subscripting & \\
		& \verb|x.ident| & \verb|dispatch| & Attribute access & \\
	\hline
	
	2
		& \verb|!x| & \verb|preNot| & Logical NOT & Cannot be chained \\
		& \verb|-x| & \verb|preMinus| & Sign negation & \\
		& \verb|~x| & \verb|preTilde| & Bitwise NOT & \\
		& \verb|*x| & \verb|preMult| & Dereference & \\
		& \verb|&x| & \verb|preAnd| & Adress of & \\
		& \verb|++x| & \verb|preInc| & Prefix increment & \\
		& \verb|--x| & \verb|preDec| & Prefix decrement & \\
		\cline{2-5}
		& \verb|x++| & \verb|suffInc| & Suffix increment & Cannot be chained \\
		& \verb|x--| & \verb|suffDec| & Suffix decrement & \\
		\cline{2-5}
		& \verb|x!| & \verb|suffNot| & Mutable type & Left to right \\
		& \verb|x*| & \verb|suffMult| & Pointer of type & \\
		& \verb|x&| & \verb|suffAnd| & Reference of type & \\
		\cline{2-5}
		& \verb|$| & \verb|dollar| & Array size & \\
	\hline
	
	3
		& \verb|x * y| & \verb|binMult| & Multiplication & Left to right \\
		& \verb|x / y| & \verb|binDiv| & Division \\
		\cline{2-5}
		& \verb|x % y| & \verb|binMod| & Modulo & Cannot be chained \\
	\hline
	
	4
		& \verb|x + y| & \verb|binPlus| & Addition & Left to right \\
		& \verb|x - y| & \verb|binMinus| & Subtraction & \\
	\hline
	
	\multirow{4}{1.5cm}{\centering 5\\(cannot use P3,P4)}
		& \verb|x & y| & \verb|binAnd| & Bitwise AND & Left to right, \\
		& \verb$x | y$ & \verb|binOr| & Bitwise OR & only the same \\
		& \verb|x ^ y| & \verb|binXor| & Bitwise XOR & \\
		\cline{2-5}
		& \verb|x >> y| & \verb|binRSft| & Bitwise right shift & Cannot be chained \\
		& \verb|x << y| & \verb|binLSft| & Bitwise left shift & \\
		& \verb|x >>> y| & \verb|binRRot| & Bitwise right circular shift & \\
		& \verb|x <<< y| & \verb|binLRot| & Bitwise left circular shift & \\
	\hline
	
	6
		& \verb|x is y| & \verb|binIs| & Is (something like equal to) & Cannot be chained \\
		& \verb|x !is y| & \verb|binIsNot| & Is not & \\
		& \verb|x in y| & \verb|binIn| & In & \\
		& \verb|x !in y| & \verb|binNotIn| & Not in & \\
		& \verb|x != y| & \verb|binNeq| & Not equal to & \\
		\cline{2-5}
		& \verb|x < y| & \verb|binLess| & Less than & Left to right, \\
		& \verb|x <= y| & \verb|binLeq| & Less than or equal to & specific chaining rules \\
		& \verb|x == y| & \verb|binEq| & Equal to & \\
		& \verb|x >= y| & \verb|binGeq| & Greater than or equal to & \\
		& \verb|x > y| & \verb|binGrt| & Less than & \\
	\hline
	
	7
		& \verb|x && y| & \verb|binLogAnd| & Logical AND & Left to right, \\
		& \verb$x || y$ & \verb|binLogOr| & Logical OR & only the same \\
	\hline
	
	8
		& \verb|x ? y : z| & \verb|tern| & Ternary conditional & Cannot be chained \\
	\hline
	
	9
		& \verb|x = y| & \verb|assign| & Assignment & Right to left, \\
		& \verb|x := y| & \verb|refAssign| & Reference assignment & only the same \\
		\cline{2-5}
		& \verb|x += y| & \verb|plusAssign| & Various assignments & Cannot be chained \\
		& \verb|x -= y| & \verb|minusAssign| && \\
		& \verb|x *= y| & \verb|multAssign| && \\
		& \verb|x /= y| & \verb|divAssign| && \\
		& \verb|x %= y| & \verb|modAssign| && \\
		& \verb|x &= y| & \verb|andAssign| && \\
		& \verb$x |= y$ & \verb|orAssign| && \\
		& \verb|x ^= y| & \verb|xorAssign| && \\
		& \verb|x <<= y| & \verb|lSftAssign| && \\
		& \verb|x >>= y| & \verb|rSftAssign| && \\
		& \verb|x <<<= y| & \verb|lRotAssign| && \\
		& \verb|x >>>= y| & \verb|rRotAssign| && \\
	\hline
		
	10 (cannot use P9)
		& \verb|x .. y| & \verb|range| & Range separator (only in array subscript args) & Cannot be chained \\
	\hline
	
	11
		& \verb|x, y| & & Comma & Left to right \\
\end{centeredRefTabular}

\paragraph{Associativity -- explanation}
\begin{compactitem}
	\item \textbf{Left to right} Operations from the same group are processed from left to right, meaning \inlineCode{x + y + z} is processed as \inlineCode{(x + y) + z}.
	\item \textbf{Right to left} Operations from the same group are processed from right to left, meaning \inlineCode{x = y = z} is processed as \inlineCode{x = (y = z)}.
	\item \textbf{Cannot be chained} Operations cannot be chained with any operator of the same priority, meaning expressions like \inlineCode{x >> y >> z}, \inlineCode{x >> y << z} or \inlineCode{++!x} are syntactically incorrect.
	\item \textbf{Only the same} Only the same operators can be chained, meaning \inlineCode{x & y & z} and \inlineCode{x | y | z} is correct, but \inlineCode{x & y | z} is not.
\end{compactitem}

\paragraph{Operator precedence specialities}
In order to improve code readability, it is prohibited to use priority 3 and 4 operations as priority 5 operands -- you must wrap them in the parentheses.
\begin{code}
x + y >> z; // Error
(x + y) >> z; // Ok
\end{code}

Also, you cannot use P9 operations as operands in the \verb|[args]| operator.

\subsection{Comparison operators chaining} Comparison operators can be chained in monotonous order:
\begin{code}
// (Almost) equivalent with (a > b) && (b >= c) && (c == d) && (d >= e) && (e > f)
a > b >= c == d >= e > f;
// (Almost) equivalent with (a <= b) && (b < c) && (c <= d) && (d == e) && (e < f)
a <= b < c <= d == e < f;
// (Almost) equivalent with (a == b) && (b == c)
a == b == c;
// Syntax error
a > b < c;
\end{code}

When chaining comparison operators, the expressions in form \inlineCode{x == y > z} are internally rewritten to \inlineCode{(x == y) && (x > z)} (supports user overloaded operators), except the \verb|x|, \verb|y| and \verb|z| expressions are evaluated only once.

\section{Operator overloading}

\begin{code}
enum Operator {
	funcCall,
	brackets,
	dispatch,
	preNot,
	// etc
	;
	
@public:
	enum : This.Set {
		unary = preNot | suffNot | preMinus /* etc */,
		unaryPre = preNot | preMinus | preTilde /* etc */,
		unarySuff = suffNot | suffMult | suffAnd /* etc */,
		
		binary = binMult | binDiv | binMod /* etc */,
		anyAssign = assign | refAssign | plusAssign /* etc */
	}	
}
\end{code}

All operators can be overloaded by the programmer. This is done by overloading/implementing function:
\begin{code}
auto #operator( @ctime Operator op, auto args ... );
\end{code}

So for example, you can overload all unary operators at once using:
\begin{code}
auto #operator( @ctime Operator op, auto& args ... )
	if( op is :unary )
{
	reutrn referencedValue.#operator( op, ::args );
}
\end{code}

or you can overload one exact operator:
\begin{code}
Int16 #operator( Operator.preNot ) {
	return !referencedValue;	
}
Int16 #operator( Operator("x++") ) {
	return !referencedValue;	
}
\end{code}

You can also make overloads virtual (for one exact setup):
\begin{code}
class A {
	@public @abstract Void #operator( Operator.plusAssign, A& other );
}

@final class B : @public A {
	@public @override Void #operator( Operator.plusAssign, A& other ) {
		// code here	
	}
}
\end{code}

\paragraph{TODO} The range operator, operator parameter restrictions, overload selection

\section{Variable declarations}
\begin{grammar}
	\grDef{InexprVarDecl} ( \gr{UnaryExpr} | \gr{AutoType} ) \token{Identifier} [ \gr{VarDeclCtor} ] \\
	\grDef{AutoType} \kwd{auto} [ \kwd{\&} ] [ \kwd{!} ] \\
	\grDef{VarDeclCtor} \gr{ParentCommaExpr} | \kwd{=} \gr{Expression} \\
\end{grammar}

\subsection{Inexpr variable declarations}

\chapter{Functions}
\begin{grammar}
	\grDef{FunctionDecl} ( \gr{P1Expr} | \kwd{auto} ) [ \kwd{\&} ] \token{Identifier} \gr{ParentCommaExpr} [ \gr{CommandBlock} ] \\
\end{grammar}

\chapter{Modules}
\begin{grammar}
	\grDef{ModuleEntry} \kwd{module} \gr{ExtendedIdentifier} \kwd{;} \{ \gr{ModuleLvlDecl} \} \\
	\\
	\grDef{ModuleLvlDecl} \gr{ModuleLvlDeclBlock} \\
		\grAltLn \gr{ImportStmt} \\
		\grAltLn \gr{FunctionDecl} \\
		\grAltLn \gr{ScopeDecorationStmt} \\
	\grDef{ScopeDecorationStmt} \{ \gr{Decoration} \}+ \kwd{:} \\
	\grDef{ModuleLvlDeclBlock} \kwd{\{} \gr{ModuleLvlDecl} \kwd{\}} \\
\end{grammar}

The program is divided into modules. Each module begins with a module declaration statement.
\begin{code}
module package.package.moduleName;
\end{code}

The \gr{ExtendedIdentifier} in the \gr{ModuleEntry} then works as an identifier for the module. Multiple modules with the same identifier are not allowed.

\paragraph{Filesystem representation} Module identifier has to correspond with the directory structure the source file is in and the source file name has to be same as the module name (case sensitive). For example, having set up \verb|project/src| and \verb|project/include| source file directories, module \verb|straw.nati.main| has to be in file \verb|project/src/straw/nati/main.nati| or \verb|project/include/straw/nati/main.nati|.

\paragraph{Naming convention} Modules should be named in lower-CamelCase. This is not enforced, however disobeying this rule results in a warning.

\section{Imports} \label{imports}
\begin{grammar}
	\grDef{ImportStmt} \kwd{import} \gr{ExtendedIdentifier} \kwd{;}
\end{grammar}

Using the \kwd{import} statement, you can make symbols other modules accessible for the current scope.

Imports are not modified using standard access modifier decorators (\decorator{public}, \decorator{private}, etc.), but with \decorator{global} and \decorator{local}, \decorator{local} being default.

\subsection{Local imports} \label{decorator:local}
Local import makes the symbols from the specified module accessible only for the current scope (and its subscopes).

\begin{code}
module a;

Void aFunc() {
	// Do something
}

$\moduleSep$
module b;

import a; /* Equivalent with @local import a; */

Void bFunc() {
	aFunc(); // Ok
}

$\moduleSep$
module c;

import b;

Void cFunc() {
	import a;
	aFunc(); // Ok
}
Void cFunc2() {
	aFunc(); // Error	
}
\end{code}

\subsection{Global imports} \label{decorator:global}
Symbols that are imported using the global import are accessible from the current scope (and its subscopes) and all scopes that import the current scope (and their subscopes).

\begin{code}
module a;

Void aFunc() {
	// Do something
}

$\moduleSep$
module b;

@global import a;

Void bFunc() {
	aFunc(); // Ok
}

$\moduleSep$
module c;

@global import b;

Void cFunc() {
	bFunc(); // Ok
	aFunc(); // Ok	
}

$\moduleSep$
module d;

import c;

Void Func() {
	cFunc(); // Ok
	aFunc(); // Ok
}

$\moduleSep$
module e;

import d;

Void eFunc() {
	dFunc(); // Ok
	cFunc(); // Error
	aFunc(); // Error	
}
\end{code}

\chapter{Decorators}
\begin{grammar}
	\grDef{Decoration} \kwd{@} \token{Identifier} [ \gr{ArgumentList} ]
\end{grammar}

Generally, decorators provide syntax support for altering properties of types, declarations or even blocks of code.

\section{Decorator application}
In module level, there are three ways of how to apply a decorator:
\begin{code}
module a;

class C {
	
// Scope decoration
@decoratorA @decoratorB:
	Int32 d;
	Int64 c;
	
	// Block decoration
	@decoratorE @decoratorF {
		Int8! b;
		Int16! c;	
	}
	
	// Statement decoration
	@decoratorC @decoratorD Int8! a;
				
}
\end{code}

\paragraph{Scope decorations} Decorators are applied to all statements following the decoration up to next scope decoration or current scope end. You can not use scope decorations directly in the module root scope.

\paragraph{Block decorations} Decorators are applied to all statements in the block.

\paragraph{Statement decorations} Decorators are applied to the statement that follows the decoration.

\subsection{Decoration contexts} \label{decorationContexts}
There are multiple different contexts in which decorators can be used. Most decorators can't be used in all the contexts.

The contexts are following:
\begin{itemize}
	\item Module level declaration
	\item Variable declaration
	\item Function declaration
	\item Parameter declaration
	\item Class declaration
	\item Enum declaration
	\item Control statement (\kwd{if}, \kwd{for}, \kwd{while}, ...)
	\item Block of code (\verb|{ /* code here */ }|)
\end{itemize}

\begin{code}
enum DecorationContext {
	importDecoration,
	moduleLevelDeclaration,
	parameterDeclaration,
	variableDeclaration,
	functionDeclaration,
	classDeclaration,
	enumDeclaration,
	typeDecoration,
	controlStatement,
	codeBlock;
	
@public:
	enum : Set {
		typeDeclaration = classDeclaration | enumDeclaration	
	}
}
\end{code} \label{enum:DecorationContext}

\subsection{Context ambiguity resolution} In some cases, the context the decorator is used in can be ambiguous. Consider following example:
\begin{code}
Void f( @ctime Int8 param ) {
	// Code here
}
\end{code}

Here, the \decorator{ctime} decorator can be considered to be used in either \decorationContext{parameter\-Declaration}, \decorationContext{variable\-Decl\-aration} or \decorationContext{typeDecoration} context. How is it decided? The compiler tries to use contexts in order they are defined in the \verb|DecorationContext| enum, looking for a first match. If the decorator doesn't support any of the contexts available, an error is shown. This means that \textbf{you can't apply a decorator on a stuff the decorator doesn't support}. In some other langauges, the decorator would simply be ignored, but this does not apply for NATI.

In the example, it would first try to apply the decorator in  \decorationContext{parameterDeclaration} context. Because the \decorator{ctime} decorator doesn't support that context, it would try the  \decorationContext{variableDeclaration} context, which is supported, so the resolving would succeed.

\subsection{Decorator conflicts}
\textbf{You can not apply two decorators that are incompatible.} The most common case are the \hyperref[accessModifierDecorators]{access modifier decorators}.
\begin{code}
class C {

@public:
	@private Int8 a; // Error - @public and @private decorators are incompatible
	
}
\end{code}

\section{Predefined decorators}

\subsection{Import locality modifiers (\decorator{global}, \decorator{local})}
The decorators only support \decorationContext{importDecoration} context. See \nameref{imports}.

\subsection{Access modifiers (\decorator{public}, \decorator{private}, \decorator{protected} and \decorator{friend})} \label{accessModifierDecorators}
Access modifier decorators specify where a symbol is accessible from. They only support the \decorationContext{moduleLevelDeclaration} context.

\paragraph{\decorator{public}} \label{decorator:public} Symbols with the \decorator{public} access modifier are accessible from everywhere.

\paragraph{\decorator{private}} \label{decorator:private} Symbols with the \decorator{private} access modifier are accessible only from the current scope.

\paragraph{\decorator{protected}} \label{decorator:protected} The \decorator{protected} only makes sense when used in classes. It makes symbols accessible from the current scope, its subscopes and any scope that derives from any of its subscopes.

\paragraph{\decorator{friend}} \label{decorator:friend} The \decorator{friend} decorator exclusively allows access to one scope symbol, specified as the parameter. This overrides the \decorator{protected} or \decorator{private} access restriction.

\begin{code}
class C {
	@private @friend( func3 ) Int8 x;
	@protected Int16 func() {
		return 32000;
	}	
	@public Int32 y;
}

class D : @public C {
	
@public:
	Void func2() {
		x = 6; // Error
		func(); // Ok
	}
	
}

Void func3() {
	C c;
	c.x = 5; // Ok - func3 is friend with C.x
	c.func(); // Error
	c.y = 10; // Ok
}
\end{code}

\paragraph{Inter-compatibility}
The \decorator{public}, \decorator{protected} and \decorator{private} decorators are not compatible with any decorator from the three (this also means you can't apply them twice). Also, \decorator{friend} and \decorator{public} decorators are not compatible.

\subsection{The \decorator{ctime} (and \decorator{autoCtime}) decorator} \label{decorator:ctime}
Generally, the \decorator{ctime} decorator is related with compile time execution. It supports multiple contexts and depending on the context, its semantics can slightly change.

\paragraph{Compile-time parameters}
A function parameter decorated with \decorator{ctime} is a compile-time parameter. In some cases, parameters don't have to be decorated with \decorator{ctime} -- class, enum, template parameters are always compile-time and decorating them with \decorator{ctime} even results in warning.

Compile-time parameter's values must be known at compile time. Compile-time parameters can be mutable.

Technically, a function with compile-time parameter is a function template.

\begin{code}
// 'y' and 't' parameters are compile-time
Void f( Int32 x, @ctime Int32 y, @ctime Type t ) {
	
}
\end{code}

For more info, see \nameref{ctime:parameter}.

\paragraph{Compile-time variables}
A variable decorated with \decorator{ctime} is a compile-time variable. Compile-time variables defined in function bodies \textbf{can be mutable}. A compile-time variable can be of a \hyperref[ctime:class]{compile-time type}. You can not define a compile-time variable as a dynamic member of a non-compile-time class.

\begin{code}
@ctime Type! t = Int32;
t x = 5; // x is of type Int32
t = String;
t str = "asd"; // y is of type String
@ctime t str2 = "lol"; // str2 is compile-time and of type String
\end{code}

For more info, see \nameref{ctime:variable}.

\paragraph{Compile-time functions}
A function decorated with \decorator{ctime} is a compile-time function. A compile-time function is always executed at compile time. It can return a \hyperref[ctime:class]{compile-time type}. Its parameters and all variables used in its body are compile-time and the \decorator{ctime} decorator should be omitted (a warning is shown otherwise).

Because of some reasons, 

\begin{code}
@ctime Type TypeIntersection( Type t1, Type t2 ) {
	// if t2 is parent of t1
	if( t1 is t2 )
		return t2;
		
	// if t1 is parent of t2
	else if( t2 is t1 )
		return t1;
	
	else
		return Void;
}
\end{code}

For more info, see \nameref{ctime:function}

\paragraph{Compile-time classes}
A class decorated with \decorator{ctime} is a compile-time class. A compile-time class can exists only during compilation. All its member functions are \hyperref[ctime:function]{compile-time functions}, all its member variables are \hyperref[ctime:variable]{compile-time variables} (the \decorator{ctime} decorator should be omitted).

\begin{code}
@ctime class FunctionInfo {

@public:
	Void #ctor!( Function F ) {
		returnType = F.#returnType;
		parameterTypes = F.#parameters.map( ( x ) => x.type );
	}
	
@public:
	Type returnType;
	Type[] parameterTypes;	
	
}
\end{code}

For more info, see \nameref{ctime:class}.

\paragraph{Compile-time control statements}
A control statement decorated with \decorator{ctime} is a compile-time control statement. In a compile-time control statement, \textbf{expressions in the statement are evaluated in compile-time, but the statement bodies are evaluated at runtime}.

All variables declared in the statement expressions are compile-time. They should be decorated with the \decorator{ctime} decorator (a warning is shown otherwise).

\begin{code}
@ctime Type! t = Int8;

if( 3 == 5 )
	t = Int16; // Warning: compile-time variable modification inside a runtime control statement

// t == Int16 here

@ctime if( 4 == 5 )	
	t = Int32;
	
// t == Int16
\end{code}

\begin{code}
@ctime for( @ctime Int16 x = 0; x < 20; x ++ ) {
	// x is a compile-time variable
	writeln( "lol" );
	// The code generated from this would be twenty writeln("lol") calls
}

for( Int16 x = 0; x < 20; x ++ ) {
	// x is a runtime variable, the loop is executed at runtime	
}
\end{code}

\paragraph{Compile-time code block} A code block decorated with the \decorator{ctime} is executed at compile time. All variables declared in it are compile time and they should not be decorated with the \decorator{ctime} decorator.

\paragraph{The \decorator{autoCtime} decorator} \label{decorator:autoCtime} This decorator works similar to the \decorator{ctime}, except it only makes things compile-time when it is convenient.

In \decorationContext{classDeclaration} and \decorationContext{enumDeclaration}, it makes the type compile-time if it derives from a compile-time type or if it has a nonstatic compile-time member. For example, container types should be decorated with \decorator{autoCtime} so they can store compile-time types.

In the \decorationContext{parameterDeclaration} context, the parameter is made compile-time whenever the function is called with a parameter value that is known at compile time.
\begin{code}
class HashTable( Type Key, Type Value ) {

@public:
	T!& #operator!( Operator("x[args]"), @autoCtime Key key ) {
		Offset hash = key.#hash() % tableSize_;	
		
		// Locating the record here 
	}
	
}

Void main() {
	HashTable( String, Int32 )! table;
	
	table[ stdin.read() ] = 5;
	
	// Here the #key parameter is known at compile time, so the function is optimized (the hash calculation is performed at compile time)
	table[ "key" ] = 10;
}
\end{code}

In the \decorationContext{functionDeclaration} context, the function is made compile-time when all of its parameters (all of them must be decorated with \decorator{autoCtime} or \decorator{ctime}) and/or return type are compile time.

In the \decorationContext{variableDeclaration} context, the variable is made compile time if its type is compile time.

The decorator can not be used in any other contexts.

\chapter{Plans for the future}
\begin{itemize}
	\item Aliased imports
	\item Namespaces
	\item User decorators
	\item Blueprints -- "mixin classes"
	\item Mixins
	\item Mixins but no mixins (not mixing a string, mixing a declaration)
	\item Lambdas
	\item Singletons
	\item Extern functions -- cooperation with other programming languages
	\item Compiler support for documentation comments?
	\item Compiler outputs intellisense data?
	\item Compiler caching
\end{itemize}

\end{document}          
